# 享元模式(Flyweight Pattern)
享元模式是設計模式中，少數幾個以提高系統性能為目的的模式之一，核心思想是對相同或者類似的對象進行複用，以減少相同或者類似的對象的創建數量，從而減少內存佔用，提高性能。

在享元模式中，由於需要構造和維護這些可以共享的對象，因此常會出現一個工廠類，用於維護和創建對象。享元工廠是享元模式的核心，它需要確保系統可以共享相同的對象。一般情況下，享元工廠會維護一個對象列表，當任何組件嘗試獲取享元類時，如果請求的享元類已經被創建，則直接返回已有的享元類；若沒有，則創建一個新的享元對象，並將它加入到維護隊列中。

如果應用程式中使用了大量的外部對象，而這些大量對象造成了很大的開銷，就應該考慮使用享元模式；還有就是對向的大多數狀態可以是外部狀態，如果刪除對象的外部狀態，可以用相對較少的共享對象取代很多組對象，也可以考慮使用享元模式。

### 內部狀態 & 外部狀態
1. 內部狀態
    - 指在享元對象內部，且不會隨環境改變而改變的狀態
2. 外部狀態
    - 指不可以被共享，而且會隨環境改變而變化的狀態
    
 內部狀態儲存於ConcreteFlyweight中，外部對象應考慮由客戶端儲存或計算狀態，當調用Flyweight對象的操作時，再將該狀態傳給它。把參數移到實例外面，再調用方法實在將它傳遞過來，就可以透過共享大幅的減少單個實例個數。

## 組成
1. 抽象享元類(Flyweight)：所有具體享元類的父類或接口。
2. 具體享元類(ConcreteFlyweight)：繼承或實現Flyweight的接口，並為內部狀態增加儲存空間。
3. 非共享具體享元類(UnsharedConcreteFlyweight)：不須共享的Flyweight子類。儘管我們大部分的時間都須共享對象來降低耗損，但個別時候也有可能不需要共享，UnsharedConcreteFlyweight用來解決那些不需要共享對想的問題。
4. 享元工廠類(FlyweightFactory)：用來創建並管理Flyweight對象，主要是用來確保合理的共享Flyweight。當用戶請求一個Flyweight時，FlyweightFactory對象提供一個以創建的實例或創建一個新的。

## 範例
網站共享代碼。

## 參考
- [JAVA設計模式-享元模式（Flyweight） - 簡書](https://www.jianshu.com/p/f88b903a166a)
- [設計模式——享元模式| BrightLoong's Blog](https://brightloong.github.io/2018/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/)
- [享元模式和单例模式的区别 - epeaktop的专栏 - CSDN博客](https://blog.csdn.net/epeaktop/article/details/51830631)

## Run
```
php index.php
```

